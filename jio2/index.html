<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Shaka · Sports stream</title>
    <!-- Shaka Player compiled library -->
    <script src="https://cdn.jsdelivr.net/npm/shaka-player@4.7.11/dist/shaka-player.compiled.js"></script>
    <!-- Font Awesome for optional close icon, but we use pure CSS modal -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Roboto, system-ui, -apple-system, sans-serif;
            background: linear-gradient(145deg, #0b1a2e 0%, #1a2f40 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 1.5rem;
            margin: 0;
        }

        .header {
            width: 100%;
            max-width: 1100px;
            margin-bottom: 2rem;
            color: white;
            text-align: center;
        }

        .header h1 {
            font-weight: 400;
            font-size: clamp(1.8rem, 6vw, 2.6rem);
            letter-spacing: 1px;
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(4px);
            display: inline-block;
            padding: 0.6rem 2rem;
            border-radius: 60px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.6);
            border: 1px solid rgba(255,215,0,0.2);
        }

        .header h1 i {
            color: #f5c542;
            margin-right: 10px;
        }

        /* channel grid — fully responsive */
        .channel-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: stretch;
            gap: 2rem;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
        }

        .channel-card {
            background: rgba(20, 30, 40, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 215, 0, 0.25);
            border-radius: 36px;
            padding: 2rem 1.5rem 1.8rem 1.5rem;
            box-shadow: 0 25px 40px -10px rgba(0, 0, 0, 0.7), 0 0 0 1px rgba(255,200,50,0.1) inset;
            transition: transform 0.2s ease, box-shadow 0.2s;
            width: 280px;
            min-width: 260px;
            flex: 1 1 260px;
            max-width: 320px;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            color: white;
        }

        .channel-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 32px 55px -8px black, 0 0 0 2px rgba(255, 215, 0, 0.6) inset;
            border-color: rgba(255, 215, 0, 0.7);
        }

        .logo-wrapper {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            background: #0f212f;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 18px;
            margin-bottom: 1.5rem;
            box-shadow: 0 10px 18px rgba(0,0,0,0.6), 0 0 0 2px #2d4055;
            transition: all 0.15s;
        }

        .channel-card:hover .logo-wrapper {
            box-shadow: 0 14px 24px #000, 0 0 0 3px #f5c542;
        }

        .logo-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 2px 4px black);
        }

        .channel-name {
            font-size: 1.7rem;
            font-weight: 600;
            text-align: center;
            line-height: 1.2;
            margin-bottom: 0.4rem;
            text-shadow: 0 2px 5px black;
            word-break: break-word;
        }

        .channel-language {
            font-size: 1rem;
            background: #2b3f54;
            padding: 0.3rem 1.2rem;
            border-radius: 40px;
            display: inline-block;
            color: #e0eefa;
            letter-spacing: 0.4px;
            font-weight: 400;
            border: 1px solid #56738f;
            margin-top: 0.2rem;
        }

        .play-hint {
            margin-top: 1.2rem;
            font-size: 0.95rem;
            color: #bcccdb;
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(0,0,0,0.4);
            padding: 0.5rem 1.4rem;
            border-radius: 40px;
            border: 1px dashed #a3b8cc;
        }

        .play-hint i {
            color: #f5c542;
        }

        /* ----- MODAL (pop‑up) ----- */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(6px);
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 1rem;
        }

        .modal-card {
            background: #0b1a24;
            width: 100%;
            max-width: 1000px;
            border-radius: 2rem;
            box-shadow: 0 30px 60px rgba(0,0,0,0.9), 0 0 0 2px #f5c54266;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            max-height: 90vh;
            border: 1px solid rgba(255,215,0,0.5);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.8rem;
            background: #0a141f;
            border-bottom: 1px solid #2b4a5e;
            color: white;
            flex-wrap: wrap;
            gap: 10px;
        }

        .modal-header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .modal-header-left img {
            width: 48px;
            height: 48px;
            object-fit: contain;
            background: #1f3543;
            border-radius: 50%;
            padding: 6px;
            border: 1px solid #9e7e3f;
        }

        .modal-header-left h2 {
            font-size: 1.8rem;
            font-weight: 500;
        }

        .modal-close {
            background: none;
            border: none;
            color: #ddd;
            font-size: 2.8rem;
            line-height: 1;
            cursor: pointer;
            padding: 0 0.5rem;
            transition: 0.1s;
        }
        .modal-close:hover {
            color: #f5c542;
            transform: scale(1.2);
        }

        .video-container {
            position: relative;
            width: 100%;
            background: black;
            aspect-ratio: 16 / 9;
        }

        #shaka-player {
            width: 100%;
            height: 100%;
            display: block;
            outline: none;
        }

        .modal-footer {
            padding: 0.8rem 1.8rem;
            background: #0f1d29;
            color: #adc4db;
            font-size: 0.9rem;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
            border-top: 1px solid #2a4050;
        }

        .stream-info i {
            margin-right: 6px;
            color: #e5b13b;
        }

        /* small screen love */
        @media (max-width: 520px) {
            .channel-card {
                min-width: 100%;
                max-width: 100%;
            }
            .modal-header-left h2 {
                font-size: 1.4rem;
            }
            .modal-header-left img {
                width: 38px;
                height: 38px;
            }
        }

        /* error or loading overlay inside player */
        .shaka-overlay {
            font-family: 'Segoe UI', monospace;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-bolt"></i> LIVE SPORTS · SHAKA</h1>
    </div>

    <div class="channel-grid" id="channelGrid"></div>

    <!-- MODAL POPUP (hidden by default) -->
    <div class="modal" id="streamModal">
        <div class="modal-card">
            <div class="modal-header">
                <div class="modal-header-left">
                    <img id="modalLogo" src="" alt="logo">
                    <h2 id="modalTitle">Channel</h2>
                </div>
                <button class="modal-close" id="closeModalBtn" aria-label="close">&times;</button>
            </div>
            <div class="video-container">
                <video id="shaka-player" autoplay controls poster></video>
            </div>
            <div class="modal-footer">
                <span class="stream-info"><i class="fas fa-globe"></i> <span id="modalLang"></span></span>
                <span class="stream-info"><i class="fas fa-key"></i> encrypted · widevine</span>
                <span style="flex:1; text-align: right;" id="expiryHint"></span>
            </div>
        </div>
    </div>

    <script>
        (function() {
            // ---------- given channel data ----------
            const channelData = [
                {
                    channel_id: "204",
                    channel_name: "DD Sports",
                    channel_logo: "https://jiotv.catchup.cdn.jio.com/dare_images/images/DD_Sports.png",
                    channel_url: "https://jiotvmblive.cdn.jio.com/bpk-tv/DD_Sports_BTS/output/index.mpd?__hdnea__=st=1771313762~exp=1771400162~acl=/*~hmac=55f2c8c60af3873042385ec7be2f3b769929e6aab945d6b593b4090149d7db4d",
                    channel_genre: "Sports",
                    language: "Hindi",
                    keyId: "0c1b139b9a955134a1efae8e44b63aac",
                    key: "00897bffd6997049787270797b8c3a17",
                    cookie: "__hdnea__=st=1771313762~exp=1771400162~acl=/*~hmac=55f2c8c60af3873042385ec7be2f3b769929e6aab945d6b593b4090149d7db4d",
                    last_update: "17/02/2026 12:36:47 pm",
                    expire_time: "February 18, 2026 7:36:02 AM"
                },
                {
                    channel_id: "875",
                    channel_name: "Eurosport HD",
                    channel_logo: "https://jiotv.catchup.cdn.jio.com/dare_images/images/Dsports_HD.png",
                    channel_url: "https://jiotvmblive.cdn.jio.com/bpk-tv/Dsports_HD_BTS/output/index.mpd?__hdnea__=st=1771313762~exp=1771400162~acl=/*~hmac=55f2c8c60af3873042385ec7be2f3b769929e6aab945d6b593b4090149d7db4d",
                    channel_genre: "Sports",
                    language: "English",
                    keyId: "14fc31f9d832509c9f7cdd77e622e30b",
                    key: "a884515f4e1dd77f07aa100ccec13388",
                    cookie: "__hdnea__=st=1771313762~exp=1771400162~acl=/*~hmac=55f2c8c60af3873042385ec7be2f3b769929e6aab945d6b593b4090149d7db4d",
                    last_update: "17/02/2026 12:36:47 pm",
                    expire_time: "February 18, 2026 7:36:02 AM"
                }
            ];

            // ---------- shaka initialisation ----------
            shaka.polyfill.installAll();
            if (shaka.Player.isBrowserSupported()) {
                console.log('Shaka Player supported');
            } else {
                alert('Browser not supported!');
            }

            const videoElement = document.getElementById('shaka-player');
            let player = null;

            // ----- create channel cards dynamically -----
            const grid = document.getElementById('channelGrid');
            grid.innerHTML = '';

            channelData.forEach(ch => {
                const card = document.createElement('div');
                card.className = 'channel-card';
                card.setAttribute('data-url', ch.channel_url);
                card.setAttribute('data-name', ch.channel_name);
                card.setAttribute('data-logo', ch.channel_logo);
                card.setAttribute('data-lang', ch.language);
                card.setAttribute('data-expire', ch.expire_time || '');

                // inner structure
                card.innerHTML = `
                    <div class="logo-wrapper">
                        <img src="${ch.channel_logo}" alt="${ch.channel_name}" loading="lazy" onerror="this.src='https://via.placeholder.com/130?text=Logo'">
                    </div>
                    <div class="channel-name">${ch.channel_name}</div>
                    <span class="channel-language">${ch.language}</span>
                    <div class="play-hint">
                        <i class="fas fa-play-circle"></i> click to stream
                    </div>
                `;
                grid.appendChild(card);
            });

            // ----- modal & player elements -----
            const modal = document.getElementById('streamModal');
            const closeBtn = document.getElementById('closeModalBtn');
            const modalLogo = document.getElementById('modalLogo');
            const modalTitle = document.getElementById('modalTitle');
            const modalLang = document.getElementById('modalLang');
            const expiryHint = document.getElementById('expiryHint');

            // ----- close modal -----
            function closeModalAndUnload() {
                if (player) {
                    player.destroy().then(() => {
                        player = null;
                        console.log('player destroyed');
                    }).catch(console.warn);
                }
                modal.style.display = 'none';
                videoElement.removeAttribute('src'); // avoid keep streaming
                videoElement.load();
            }

            closeBtn.addEventListener('click', closeModalAndUnload);
            window.addEventListener('click', (e) => {
                if (e.target === modal) closeModalAndUnload();
            });

            // ----- card click: load stream in modal -----
            grid.addEventListener('click', async (e) => {
                const card = e.target.closest('.channel-card');
                if (!card) return;

                const streamUrl = card.dataset.url;
                const channelName = card.dataset.name;
                const logoUrl = card.dataset.logo;
                const lang = card.dataset.lang;
                const expire = card.dataset.expire || 'session active';

                // fill modal header
                modalLogo.src = logoUrl;
                modalTitle.textContent = channelName;
                modalLang.textContent = lang;
                expiryHint.innerHTML = `<i class="far fa-clock"></i> ${expire}`;

                // show modal
                modal.style.display = 'flex';

                // make sure previous player is destroyed
                if (player) {
                    try { await player.destroy(); } catch (e) {}
                    player = null;
                }

                // init fresh player
                player = new shaka.Player(videoElement);
                player.configure({
                    drm: {
                        servers: {
                            'com.widevine.alpha': 'https://cwip-shaka-proxy.appspot.com/no_auth' 
                            // note: above is a test proxy; real license would be different.
                            // we include the provided key & keyId but can't set them without a proper license server.
                            // the given keys are stored but for demonstration we also apply them as a custom data header if needed.
                            // advanced: we can pass headers via drm.advanced, but without proper licence url it's illustrative.
                            // In shaka we can add request filter to attach cookies/keys.
                        },
                        // optional: show that we use the given keys
                        advanced: {
                            'com.widevine.alpha': {
                                'videoRobustness': 'SW_SECURE_CRYPTO',
                                'audioRobustness': 'SW_SECURE_CRYPTO'
                            }
                        }
                    },
                    manifest: {
                        retryParameters: { maxAttempts: 3 }
                    }
                });

                // attach cookie/authorization from the dataset if needed (__hdnea__)
                player.getNetworkingEngine().registerRequestFilter((type, request) => {
                    if (type === shaka.net.NetworkingEngine.RequestType.MANIFEST ||
                        type === shaka.net.NetworkingEngine.RequestType.SEGMENT ||
                        type === shaka.net.NetworkingEngine.RequestType.LICENSE) {
                        // Add cookie header from first channel (or from card dataset, but we have static)
                        // we simply add the cookie value from first channel (both share same token anyway)
                        if (channelData[0] && channelData[0].cookie) {
                            request.headers['Cookie'] = channelData[0].cookie; 
                            // also optional: include keyId as header? Not standard, just for demo.
                        }
                        // The key & keyId are shown in console, but real DRM would need license server.
                        console.log(`filter: ${request.url} – added cookie`);
                    }
                });

                // Error handler
                player.addEventListener('error', (e) => {
                    console.error('Shaka error:', e.detail);
                    // show basic message in console, but could also display on video
                });

                try {
                    await player.load(streamUrl);
                    console.log('Stream loaded!', streamUrl);
                } catch (error) {
                    console.error('Error loading stream:', error);
                    // fallback hint on video region
                    videoElement.poster = ''; 
                    // we can display a simple error message via shaka's built-in UI? but we don't use UI.
                    // quick & dirty: write on video canvas? simpler: show an alert? but avoid annoying.
                    // we can set a text track or just console, but user will see player stalled.
                }
            });

            // extra: if user closes modal, ensure stop
            window.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && modal.style.display === 'flex') {
                    closeModalAndUnload();
                }
            });

            // tiny helper for broken images
            document.querySelectorAll('img').forEach(img => {
                img.onerror = function() { this.src = 'https://via.placeholder.com/130?text=TV'; };
            });
        })();
    </script>
</body>
</html>
