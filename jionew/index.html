<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="d4f50eee230ed06cfa2ba8d70b38bce6dcf3f1e9" content="d4f50eee230ed06cfa2ba8d70b38bce6dcf3f1e9" />
  <meta name="referrer" content="no-referrer-when-downgrade" />
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 60 60'><defs><linearGradient id='grad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' style='stop-color:%231E40AF;stop-opacity:1' /><stop offset='100%' style='stop-color:%233B82F6;stop-opacity:1' /></linearGradient></defs><rect x='5' y='5' width='50' height='50' rx='10' fill='url(%23grad)'/><text x='30' y='38' text-anchor='middle' font-family='Arial, sans-serif' font-size='24' font-weight='bold' fill='white'>CA</text></svg>">
  <title>Jio+ by CineArena (JSON Feed)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.ui.min.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/controls.min.css" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #1a2b6d;
      --secondary: #2a4ab0;
      --accent: #FF8C42;
      --light: #f0f5ff;
      --dark: #0c1a4a;
      --card-bg: rgba(18, 33, 85, 0.6);
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #0c1a4a 0%, #1a2b6d 100%);
      min-height: 100vh;
      color: #fff;
      margin: 0;
      overflow-x: hidden;
    }

    body::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 10% 20%, rgba(42, 74, 176, 0.15) 0%, transparent 20%), 
                  radial-gradient(circle at 90% 80%, rgba(255, 140, 66, 0.15) 0%, transparent 20%);
      z-index: -1;
    }

    .header-gradient {
      background: rgba(26, 43, 109, 0.85);
      backdrop-filter: blur(12px);
      box-shadow: 0 4px 12px rgba(0,0,0,.15);
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .site-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 1rem;
      width: 100%;
    }

    .section-title {
      text-align: center;
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      color: white;
      position: relative;
      padding-bottom: 15px;
    }

    .section-title::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 4px;
      background: var(--accent);
      border-radius: 2px;
    }

    .category-section {
      margin-bottom: 2.5rem;
    }

    .category-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: white;
      margin-bottom: 1rem;
      padding-left: 0.5rem;
      border-left: 4px solid var(--accent);
    }

    .channels-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 25px;
      width: 100%;
    }

    .channel-card {
      transition: all .3s ease;
      border-radius: 15px;
      overflow: hidden;
      background: rgba(12, 26, 74, 0.7);
      position: relative;
      backdrop-filter: blur(10px);
      border: 2px solid transparent;
      cursor: pointer;
      height: 220px;
      display: flex;
      flex-direction: column;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
    }

    .channel-card:hover {
      transform: translateY(-8px) scale(1.03);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
      background: rgba(26, 43, 109, 0.8);
      border-color: var(--accent);
    }

    .channel-card.active {
      border-color: var(--accent);
      background: rgba(255, 140, 66, 0.1);
      transform: translateY(-4px);
    }

    .channel-image-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 25px 15px 15px;
      background: linear-gradient(135deg, rgba(26, 43, 109, 0.8) 0%, rgba(42, 74, 176, 0.6) 100%);
    }

    .channel-image {
      height: 100px;
      width: 100%;
      background-size: contain;
      background-position: center;
      background-repeat: no-repeat;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .channel-title {
      padding: 15px 10px;
      text-align: center;
      font-size: 0.95rem;
      font-weight: 600;
      background: rgba(12, 26, 74, 0.9);
      border-top: 1px solid rgba(255,255,255,0.1);
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .mobile-menu {
      transform: translateX(-100%);
      transition: transform .28s ease-in-out;
    }

    .mobile-menu.active {
      transform: translateX(0);
    }

    .telegram-btn {
      background: #09C842;
      color: white;
      border-radius: 50%;
      width: 42px;
      height: 42px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all .3s ease;
      box-shadow: 0 4px 10px rgba(255, 106, 0, 0.3);
    }

    .telegram-btn:hover {
      transform: scale(1.08);
    }

    .minimal-footer {
      background: rgba(12, 26, 74, 0.9);
      color: white;
      padding: 10px 0;
      text-align: center;
      font-size: .9rem;
      backdrop-filter: blur(5px);
      border-top: 1px solid rgba(255,255,255,0.1);
    }

    .telegram-link {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      background: linear-gradient(135deg, #09C842 0%, #09C842 100%);
      color: white;
      padding: 10px 20px;
      border-radius: 30px;
      margin-top: 10px;
      text-decoration: none;
      transition: all .3s ease;
      font-weight: 600;
      box-shadow: 0 4px 15px rgba(255,106,0,0.18);
      font-size: 0.95rem;
    }

    .telegram-float {
      position: fixed;
      width: 55px;
      height: 55px;
      bottom: 20px;
      right: 20px;
      background: #0088cc;
      color: white;
      border-radius: 50%;
      text-align: center;
      box-shadow: 0 8px 16px rgba(0,0,0,0.3);
      z-index: 100;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: transform .3s, box-shadow .3s;
    }

    .telegram-float:hover {
      transform: scale(1.12);
      box-shadow: 0 12px 18px rgba(0,0,0,0.4);
    }

    /* Header with Jio+ Live Channels on left and Search on right */
    .main-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
      margin: 0 0 30px 0;
      flex-wrap: wrap;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .header-title {
      font-size: 2rem;
      font-weight: 800;
      background: linear-gradient(45deg, #FF8C42, #FF6B00);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      letter-spacing: 0.5px;
    }

    .header-right {
      flex: 1;
      max-width: 500px;
    }

    .search-box {
      width: 100%;
      padding: 14px 24px;
      border-radius: 30px;
      border: none;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      color: white;
      font-size: 1rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
      transition: all 0.3s ease;
    }

    .search-box:focus {
      outline: none;
      background: rgba(255, 255, 255, 0.15);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.35);
      border: 1px solid rgba(255, 140, 66, 0.5);
    }

    .search-box::placeholder {
      color: rgba(255, 255, 255, 0.7);
    }

    .futuristic-logo {
      position: relative;
    }

    .futuristic-logo::before {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, transparent, #3b82f6, #10b981, transparent);
      border-radius: 2px;
    }

    /* Player Modal Styles */
    .player-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      backdrop-filter: blur(10px);
    }

    .player-modal.active {
      display: flex;
    }

    .player-modal-content {
      width: 95%;
      max-width: 1200px;
      max-height: 90vh;
      background: rgba(12, 26, 74, 0.95);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .player-modal-header {
      padding: 20px 25px;
      background: rgba(26, 43, 109, 0.95);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .player-modal-body {
      padding: 0;
    }

    .player-video-container {
      position: relative;
      width: 100%;
      padding-top: 56.25%; /* 16:9 Aspect Ratio */
      background: #000;
    }

    .player-video-container video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .shaka-video-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .player-controls {
      display: flex;
      gap: 12px;
    }

    .player-control-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 15px;
      font-weight: 500;
    }

    .player-control-btn:hover {
      background: rgba(255, 140, 66, 0.3);
      border-color: var(--accent);
      transform: translateY(-2px);
    }

    .close-modal-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      background: rgba(255, 50, 50, 0.2);
      border: 1px solid rgba(255, 100, 100, 0.3);
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      z-index: 10;
    }

    .close-modal-btn:hover {
      background: rgba(255, 50, 50, 0.4);
      transform: scale(1.1);
    }

    .loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      z-index: 1000;
      background: rgba(0, 0, 0, 0.9);
      padding: 25px 30px;
      border-radius: 15px;
      border: 1px solid rgba(255, 140, 66, 0.3);
      display: none;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 3px solid rgba(255, 140, 66, 0.1);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .error-message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 50, 50, 0.9);
      color: white;
      padding: 20px 25px;
      border-radius: 10px;
      text-align: center;
      display: none;
      z-index: 1001;
      max-width: 80%;
      font-size: 14px;
      border: 1px solid rgba(255, 100, 100, 0.5);
    }

    .channel-count-badge {
      background: rgba(255, 140, 66, 0.2);
      color: var(--accent);
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      margin-left: 10px;
      border: 1px solid rgba(255, 140, 66, 0.3);
    }

    /* Responsive adjustments */
    @media (max-width: 1400px) {
      .channels-grid {
        grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
        gap: 20px;
      }
    }

    @media (max-width: 1200px) {
      .channels-grid {
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: 18px;
      }
      .channel-card {
        height: 210px;
      }
    }

    @media (max-width: 992px) {
      .channels-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 16px;
      }
      .channel-card {
        height: 200px;
      }
      .channel-image {
        height: 90px;
      }
      .section-title { 
        font-size: 1.6rem; 
      }
      .category-title {
        font-size: 1.3rem;
      }
      .main-header {
        flex-direction: column;
        align-items: stretch;
        gap: 20px;
      }
      .header-left, .header-right {
        width: 100%;
      }
      .header-right {
        max-width: 100%;
      }
      .header-title {
        font-size: 1.8rem;
      }
    }

    @media (max-width: 768px) {
      .channels-grid {
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 15px;
      }
      .channel-card {
        height: 190px;
      }
      .channel-image {
        height: 85px;
      }
      .channel-title {
        font-size: 0.9rem;
        padding: 12px 8px;
      }
    }

    @media (max-width: 640px) {
      .channels-grid {
        grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
        gap: 14px;
      }
      .channel-card {
        height: 180px;
      }
      .channel-image {
        height: 80px;
      }
      .header-title {
        font-size: 1.6rem;
      }
    }

    @media (max-width: 480px) {
      .channels-grid {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 12px;
      }
      .channel-card {
        height: 170px;
      }
      .channel-image {
        height: 75px;
      }
      .channel-title {
        font-size: 0.85rem;
        padding: 10px 6px;
      }
      .search-box {
        padding: 12px 20px;
        font-size: 0.95rem;
      }
      .header-title {
        font-size: 1.4rem;
      }
    }

    ::-webkit-scrollbar {
      width: 8px;
      height: 6px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(255, 140, 66, 0.5);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 140, 66, 0.8);
    }

    .empty-state {
      grid-column: 1 / -1;
      text-align: center;
      padding: 40px 20px;
      color: #aaa;
    }

    .empty-state i {
      font-size: 48px;
      margin-bottom: 15px;
      color: rgba(255, 140, 66, 0.3);
    }

    .empty-state p {
      font-size: 16px;
      font-weight: 500;
    }
  </style>
</head>
<body>
  <header class="header-gradient text-white site-container flex items-center justify-between sticky top-0 z-40 py-3">
    <button id="openMenu" class="lg:hidden text-white" aria-label="Open menu">
      <svg class="h-7 w-7" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </button>
    <a href="https://cinearena.live" class="absolute left-1/2 transform -translate-x-1/2 lg:static lg:transform-none">
      <span class="text-2xl font-bold tracking-wide tracking-tight futuristic-logo">
        CineArena<span class="text-green-400">.Live</span>
      </span>
    </a>
    <div class="flex items-center gap-3">
      <a href="https://t.me/cine_arena" target="_blank" rel="noopener" class="telegram-btn" aria-label="Telegram channel">
        <i class="fab fa-telegram text-xl" aria-hidden="true"></i>
      </a>
    </div>
  </header>

  <div id="mobileMenu" class="mobile-menu fixed inset-0 z-50 lg:hidden" aria-hidden="true">
    <div id="overlay" class="absolute inset-0 bg-black/70" onclick="toggleMenu()"></div>
    <div class="relative w-4/5 max-w-xs h-full bg-[#0c1a4a] shadow-xl" role="dialog" aria-modal="true">
      <div class="px-4 py-3 flex justify-between items-center header-gradient">
        <span class="text-xl font-bold text-white">
          CineArena<span class="text-green-400">.Live</span>
        </span>
        <button onclick="toggleMenu()" class="text-white p-1 rounded-full hover:bg-white/20" aria-label="Close menu">
          <svg class="h-6 w-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <nav class="p-4">
        <ul class="space-y-3">
          <li><a href="https://cinearena.live" class="flex items-center px-4 py-3 rounded-lg text-gray-300 hover:bg-blue-500/20 hover:text-white"><i class="fas fa-home mr-3 text-lg text-blue-400"></i>Home</a></li>
          <li><a href="https://cinearena.live/sports/" class="flex items-center px-4 py-3 rounded-lg text-gray-300 hover:bg-blue-500/20 hover:text-white"><i class="fas fa-baseball-bat-ball mr-3 text-lg text-orange-400"></i>Sports</a></li>
          <li><a href="https://cinearena.live/fancode/" class="flex items-center px-4 py-3 rounded-lg text-gray-300 hover:bg-blue-500/20 hover:text-white"><i class="fas fa-tv mr-3 text-lg text-blue-400"></i>Fancode</a></li>
          <li><a href="https://cinearena.live/movies/" class="flex items-center px-4 py-3 rounded-lg text-gray-300 hover:bg-blue-500/20 hover:text-white"><i class="fas fa-film mr-3 text-lg text-yellow-400"></i>Movies</a></li>
          <li><a href="https://t.me/cine_arena" target="_blank" rel="noopener" class="flex items-center px-4 py-3 rounded-lg text-gray-300 hover:bg-blue-500/20 hover:text-white"><i class="fab fa-telegram mr-3 text-lg text-blue-300"></i>Telegram Channel</a></li>
        </ul>
      </nav>
    </div>
  </div>

  <main class="site-container px-4 py-6 mx-auto" id="main">
    <!-- Header with "Jio+ Live Channels" on left and Search on right -->
    <div class="main-header">
      <div class="header-left">
        <div class="header-title">
          Jio+ Live Channels
        </div>
      </div>
      <div class="header-right">
        <input 
          type="text" 
          id="searchBox" 
          placeholder="Search Channels..." 
          class="search-box"
        />
      </div>
    </div>
    
    <!-- Categories Container (populated by JSON) -->
    <div id="categoriesContainer"></div>
    
    <!-- Loading indicator -->
    <div id="loading" class="text-center py-12">
      <div class="inline-block animate-spin rounded-full h-16 w-16 border-t-3 border-b-3 border-orange-500"></div>
      <p class="mt-4 text-gray-300 text-lg">Loading channels from JSON feed...</p>
    </div>
    
    <!-- Disclaimer -->
    <div class="mt-8 p-5 bg-blue-900/30 rounded-lg border border-blue-700/50">
      <p class="text-sm text-gray-300 text-center">
        This site is not affiliated with any television channel. All content is copyright of their respective owners. 
        We cannot accept any responsibility for the content on this site. All links provided are from third-party sources.
      </p>
      <p class="text-center mt-3">
        <a href="https://t.me/cine_arena" class="text-cyan-300 hover:text-cyan-200 font-medium">Contact: https://t.me/cine_arena</a>
      </p>
    </div>
  </main>

  <!-- Player Modal -->
  <div class="player-modal" id="playerModal">
    <div class="player-modal-content">
      <div class="player-modal-header">
        <div class="flex items-center gap-4">
          <div class="w-16 h-16 rounded-full overflow-hidden border-3 border-orange-400 bg-white">
            <img id="currentLogo" src="" alt="Channel Logo" class="w-full h-full object-contain p-2">
          </div>
          <div>
            <h3 id="currentChannelName" class="text-xl font-bold">Select a Channel</h3>
            <span id="currentCategory" class="text-sm text-gray-300 bg-blue-500/30 px-4 py-1.5 rounded-full">JSON Feed</span>
          </div>
        </div>
        <div class="player-controls">
          <button class="player-control-btn" onclick="window.channelManager?.refreshChannel()">
            <i class="fas fa-sync-alt"></i> Refresh
          </button>
          <button class="player-control-btn" onclick="toggleFullscreen()">
            <i class="fas fa-expand"></i> Fullscreen
          </button>
          <button class="player-control-btn" onclick="closePlayer()">
            <i class="fas fa-times"></i> Close
          </button>
        </div>
      </div>
      <div class="player-modal-body">
        <div class="close-modal-btn" onclick="closePlayer()">
          <i class="fas fa-times text-lg"></i>
        </div>
        <div class="player-video-container">
          <div class="shaka-video-container" id="shakaPlayer">
            <video autoplay playsinline preload="metadata" poster=""></video>
          </div>
          <div class="loading" id="loadingSpinner">
            <div class="spinner"></div>
            <p class="text-lg">Loading channel...</p>
          </div>
          <div class="error-message" id="errorMessage"></div>
        </div>
      </div>
    </div>
  </div>

  <a href="https://t.me/cine_arena" class="telegram-float" target="_blank">
    <i class="fab fa-telegram text-2xl"></i>
  </a>

  <div class="minimal-footer mt-8">
    <div class="site-container">
      <a href="https://t.me/cine_arena" target="_blank" rel="noopener" class="telegram-link">
        <i class="fab fa-telegram" aria-hidden="true"></i>
        Join our Telegram Channel
      </a>
    </div>
  </div>

  <script>
    (function() {
      // ==================== ChannelManager using JSON feed ONLY ====================
      class ChannelManager {
        constructor() {
          this.channels = [];
          this.categories = new Set();
          this.currentChannel = null;
          this.filteredChannels = [];
          
          // JSON feed URL - Using your actual JSON endpoint
          // Replace this URL with your actual GitHub raw JSON URL
          this.jsonUrl = 'https://raw.githubusercontent.com/cricstream4u/t20wc/main/jio.json';
          
          this.desktopPlayer = null;
          this.desktopVideo = null;
          this.desktopUI = null;
          this.isDesktopInitialized = false;
          this.defaultLogo = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iNDUiIHN0cm9rZT0iI0ZGOTkwMDAiIHN0cm9rZS13aWR0aD0iMiIvPjxwYXRoIGQ9Ik0zNSA1MEw1MCA2NUw3MCA0NSIgc3Ryb2tlPSIjRkZGOTkwMCIgc3Ryb2tlLXdpZHRoPSI1IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=';
        }

        async loadJSON() {
          try {
            console.log('Fetching JSON from:', this.jsonUrl);
            
            // Add cache busting
            const urlWithCache = this.jsonUrl + '?t=' + Date.now();
            
            const response = await fetch(urlWithCache, {
              method: 'GET',
              headers: {
                'Accept': 'application/json',
                'Cache-Control': 'no-cache'
              },
              mode: 'cors'
            });
            
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status} - ${response.statusText}`);
            }
            
            const data = await response.json();
            console.log('Successfully fetched JSON data:', data);
            
            if (!data || data.length === 0) {
              throw new Error('JSON data is empty');
            }
            
            this.parseChannels(data);
            this.populateCategories();
            this.setupSearch();
            
            // Hide loading indicator
            document.getElementById('loading').style.display = 'none';
            
          } catch (err) {
            console.error('Failed to load JSON:', err);
            
            // Show error message - NO FALLBACK DATA
            const loadingEl = document.getElementById('loading');
            loadingEl.innerHTML = `
              <div class="text-red-500 text-center">
                <i class="fas fa-exclamation-triangle text-5xl mb-4"></i>
                <p class="text-xl font-bold mb-2">Failed to load channels</p>
                <p class="text-sm text-gray-400">${err.message}</p>
                <p class="text-sm mt-4">Please check your JSON URL and try again</p>
                <p class="text-xs mt-2 text-gray-500">URL: ${this.jsonUrl}</p>
              </div>
            `;
          }
        }

        parseChannels(jsonArray) {
          this.channels = jsonArray.map(item => ({
            id: item.channel_id,
            name: item.channel_name,
            group: item.channel_genre || 'Uncategorized',
            logo: item.channel_logo || this.defaultLogo,
            streamUrl: item.channel_url,
            licenseKey: item.key ? `${item.keyId}:${item.key}` : null,
            licenseType: item.key ? 'clearkey' : null,
            userAgent: 'plaYtv/7.1.5 (Linux;Android 13) ExoPlayerLib/2.11.6',
            cookie: item.cookie || ''
          }));
          
          this.categories.clear();
          this.channels.forEach(ch => {
            if (ch.group) this.categories.add(ch.group);
          });
          console.log(`Loaded ${this.channels.length} channels, ${this.categories.size} categories`);
        }

        populateCategories() {
          const container = document.getElementById('categoriesContainer');
          container.innerHTML = '';
          const sortedCats = Array.from(this.categories).sort();
          
          if (sortedCats.length === 0) {
            container.innerHTML = '<div class="empty-state"><i class="fas fa-tv"></i><p>No channels available</p></div>';
            return;
          }
          
          sortedCats.forEach(cat => {
            const catChannels = this.channels.filter(ch => ch.group === cat);
            const catId = 'cat-' + cat.replace(/[^a-z0-9]/gi, '-').toLowerCase();
            const section = document.createElement('div');
            section.className = 'category-section';
            section.innerHTML = `<h3 class="category-title">${cat} <span class="channel-count-badge">${catChannels.length}</span></h3><div class="channels-grid" id="${catId}"></div>`;
            container.appendChild(section);
            this.populateChannels(catChannels, catId);
          });
        }

        populateChannels(channelList, containerId) {
          const grid = document.getElementById(containerId);
          if (!grid) return;
          grid.innerHTML = '';
          channelList.forEach(ch => {
            const card = document.createElement('div');
            card.className = 'channel-card';
            card.innerHTML = `
              <div class="channel-image-container">
                <div class="channel-image" style="background-image: url('${ch.logo || this.defaultLogo}')" 
                     alt="${ch.name}" onerror="this.style.backgroundImage='url(\\'${this.defaultLogo}\\')'"></div>
              </div>
              <div class="channel-title">${ch.name}</div>
            `;
            card.addEventListener('click', () => this.selectChannel(ch.id));
            if (this.currentChannel && this.currentChannel.id === ch.id) card.classList.add('active');
            grid.appendChild(card);
          });
        }

        setupSearch() {
          const searchBox = document.getElementById('searchBox');
          if (!searchBox) return;
          let timeout;
          searchBox.addEventListener('input', (e) => {
            clearTimeout(timeout);
            timeout = setTimeout(() => this.searchChannels(e.target.value), 300);
          });
        }

        searchChannels(query) {
          const container = document.getElementById('categoriesContainer');
          const q = query.trim().toLowerCase();
          if (!q) {
            container.innerHTML = '';
            this.populateCategories();
            return;
          }

          const filtered = this.channels.filter(ch => 
            ch.name.toLowerCase().includes(q) || (ch.group && ch.group.toLowerCase().includes(q))
          );

          container.innerHTML = `<div class="category-section"><h3 class="category-title">Search Results <span class="channel-count-badge">${filtered.length}</span></h3><div class="channels-grid" id="search-results"></div></div>`;
          this.populateChannels(filtered, 'search-results');
        }

        async selectChannel(channelId) {
          const channel = this.channels.find(c => c.id == channelId);
          if (!channel) {
            this.showError('Channel not found');
            return;
          }
          this.currentChannel = channel;
          this.updateChannelInfo();
          this.updateActiveChannelCards();
          this.openPlayer();
          await this.loadChannel(channel);
        }

        updateChannelInfo() {
          const logoImg = document.getElementById('currentLogo');
          const nameEl = document.getElementById('currentChannelName');
          const catEl = document.getElementById('currentCategory');
          if (logoImg) {
            logoImg.src = this.currentChannel.logo || this.defaultLogo;
            logoImg.onerror = () => logoImg.src = this.defaultLogo;
          }
          if (nameEl) nameEl.textContent = this.currentChannel.name;
          if (catEl) catEl.textContent = this.currentChannel.group || 'JioTV';
          document.title = this.currentChannel.name + ' - JioTV Player';
        }

        updateActiveChannelCards() {
          document.querySelectorAll('.channel-card').forEach(card => {
            card.classList.remove('active');
            const title = card.querySelector('.channel-title')?.textContent;
            if (title === this.currentChannel?.name) card.classList.add('active');
          });
        }

        openPlayer() {
          document.getElementById('playerModal').classList.add('active');
        }

        closePlayer() {
          document.getElementById('playerModal').classList.remove('active');
          if (this.desktopPlayer) this.desktopPlayer.unload();
        }

        async initializePlayer() {
          shaka.polyfill.installAll();
          if (!shaka.Player.isBrowserSupported()) {
            this.showError('Browser not supported by Shaka Player');
            return false;
          }
          if (!this.isDesktopInitialized) {
            this.desktopVideo = document.querySelector('#shakaPlayer video');
            if (!this.desktopVideo) return false;
            this.desktopPlayer = new shaka.Player();
            try {
              await this.desktopPlayer.attach(this.desktopVideo);
            } catch (e) {
              this.showError('Failed to attach player');
              return false;
            }
            const container = document.getElementById('shakaPlayer');
            this.desktopUI = new shaka.ui.Overlay(this.desktopPlayer, container, this.desktopVideo);
            this.desktopUI.configure({
              controlPanelElements: ['play_pause', 'time_and_duration', 'spacer', 'mute', 'volume', 'quality', 'language', 'picture_in_picture', 'fullscreen'],
              volumeBarColors: { base: '#1a2b6d', level: '#FF8C42' },
              seekBarColors: { base: '#1a2b6d', buffered: 'rgba(255,255,255,0.3)', played: '#FF8C42' }
            });
            this.desktopPlayer.configure({
              streaming: { 
                lowLatencyMode: true, 
                bufferingGoal: 15, 
                rebufferingGoal: 2, 
                bufferBehind: 15,
                retryParameters: { timeout: 10000, maxAttempts: 5, baseDelay: 300, backoffFactor: 1.2 },
                segmentRequestTimeout: 8000, 
                useNativeHlsOnSafari: true
              },
              manifest: { retryParameters: { timeout: 8000, maxAttempts: 3 } }
            });
            this.desktopPlayer.addEventListener('error', (e) => {
              console.error('Shaka error:', e.detail);
              this.showError('Player error: ' + (e.detail.code || 'unknown'));
            });
            this.isDesktopInitialized = true;
          }
          return true;
        }

        async loadChannel(channel) {
          this.showLoading(true);
          if (!this.desktopPlayer) {
            const inited = await this.initializePlayer();
            if (!inited) { this.showLoading(false); return; }
          }

          // Configure DRM if clearkey
          if (channel.licenseKey && channel.licenseType === 'clearkey') {
            const [kid, key] = channel.licenseKey.split(':');
            this.desktopPlayer.configure({ drm: { clearKeys: { [kid]: key } } });
          }

          try {
            this.setupRequestFilters(this.desktopPlayer, channel);
            await this.desktopPlayer.load(channel.streamUrl);
            await this.attemptAutoplay();
            console.log('Loaded channel:', channel.name);
            this.showLoading(false);
          } catch (err) {
            console.error('Load error:', err);
            this.showError('Failed to load channel: ' + (err.message || 'unknown error'));
            this.showLoading(false);
          }
        }

        setupRequestFilters(player, channel) {
          if (!player.getNetworkingEngine()) return;
          
          player.getNetworkingEngine().registerRequestFilter((type, request) => {
            request.headers = request.headers || {};
            request.headers['Referer'] = 'https://www.jiotv.com/';
            request.headers['User-Agent'] = channel.userAgent || 'plaYtv/7.1.5 (Linux;Android 13) ExoPlayerLib/2.11.6';
            if (channel.cookie) {
              request.headers['Cookie'] = channel.cookie;
              if (request.uris && request.uris[0] && !request.uris[0].includes('__hdnea__')) {
                const separator = request.uris[0].includes('?') ? '&' : '?';
                request.uris[0] += separator + channel.cookie;
              }
            }
          });
        }

        async attemptAutoplay() {
          if (!this.desktopVideo) return false;
          try {
            this.desktopVideo.muted = false;
            await this.desktopVideo.play();
            return true;
          } catch {
            try {
              this.desktopVideo.muted = true;
              await this.desktopVideo.play();
              return true;
            } catch {
              return false;
            }
          }
        }

        async refreshChannel() {
          if (this.currentChannel) await this.loadChannel(this.currentChannel);
        }

        showLoading(show) {
          const spinner = document.getElementById('loadingSpinner');
          if (spinner) spinner.style.display = show ? 'block' : 'none';
        }

        showError(msg) {
          const errDiv = document.getElementById('errorMessage');
          if (errDiv) {
            errDiv.textContent = msg;
            errDiv.style.display = 'block';
            setTimeout(() => errDiv.style.display = 'none', 5000);
          }
        }
      }

      // ========== Global functions ==========
      window.toggleMenu = function() {
        document.getElementById('mobileMenu')?.classList.toggle('active');
      };

      window.closePlayer = function() {
        if (window.channelManager) window.channelManager.closePlayer();
      };

      window.toggleFullscreen = function() {
        const player = document.querySelector('#shakaPlayer');
        if (!document.fullscreenElement) {
          player?.requestFullscreen().catch(e => console.log('Fullscreen error', e));
        } else {
          document.exitFullscreen();
        }
      };

      window.refreshChannel = function() {
        window.channelManager?.refreshChannel();
      };

      // Initialize on load
      document.addEventListener('DOMContentLoaded', async () => {
        const manager = new ChannelManager();
        window.channelManager = manager;
        await manager.loadJSON();

        // Mobile menu toggle
        document.getElementById('openMenu')?.addEventListener('click', window.toggleMenu);
        window.addEventListener('resize', () => {});
      });
    })();
  </script>
</body>
</html>
