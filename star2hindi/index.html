<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>STAR SPORTS 2 HINDI HD · external JSON + grid</title>
  <!-- Shaka Player UI library & CSS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.ui.min.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/controls.min.css" crossorigin="anonymous">
  <!-- Font Awesome for icons (used in grid) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    /* base reset */
    * { margin: 0; padding: 0; box-sizing: border-box; }

    /* main layout: left panel (grid) + right panel (player) */
    body {
      background: #0a0f1a;
      font-family: system-ui, -apple-system, 'Segoe UI', sans-serif;
      display: flex;
      flex-direction: row;
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      color: white;
    }

    /* ---------- CHANNEL GRID (left side) ---------- */
    .grid-panel {
      width: 360px;
      max-width: 90vw;
      background: #0e1623;
      border-right: 1px solid #2c3f5a;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      padding: 20px 12px;
      box-shadow: 4px 0 20px rgba(0,0,0,0.6);
      z-index: 10;
    }

    .grid-header {
      padding-bottom: 16px;
      border-bottom: 1px solid #2b4259;
      margin-bottom: 20px;
    }
    .grid-header h2 {
      font-weight: 400;
      font-size: 1.8rem;
      color: #f0c45a;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .grid-header h2 i {
      font-size: 2rem;
    }
    .grid-header p {
      color: #9bb5d4;
      font-size: 0.95rem;
      margin-top: 8px;
    }

    .channel-list {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .channel-card {
      background: #142433;
      border-radius: 28px;
      padding: 22px 16px 16px 16px;
      border: 1px solid #3d5b74;
      box-shadow: 0 8px 0 #0b141f;
      transition: all 0.15s;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      backdrop-filter: blur(4px);
    }
    .channel-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 0 #0b141f, 0 0 0 2px #eab308;
      border-color: #f5c542;
    }
    .channel-card.active {
      border-color: #f5c542;
      box-shadow: 0 0 0 2px #f5c542, 0 8px 0 #0b141f;
    }

    .logo-wrapper {
      width: 100px;
      height: 100px;
      background: #1d3143;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      margin-bottom: 14px;
      border: 2px solid #566f89;
    }
    .channel-card:hover .logo-wrapper {
      border-color: #eab308;
    }
    .logo-wrapper img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      filter: drop-shadow(0 2px 6px black);
    }
    .channel-name {
      font-size: 1.6rem;
      font-weight: 600;
      line-height: 1.2;
    }
    .channel-language {
      font-size: 1rem;
      background: #1f3c54;
      padding: 0.2rem 1.2rem;
      border-radius: 40px;
      margin: 8px 0 4px;
      display: inline-block;
      border: 1px solid #7089a3;
    }
    .expiry-badge {
      font-size: 0.75rem;
      color: #c0d2e5;
      background: #00000033;
      padding: 4px 10px;
      border-radius: 20px;
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    /* ---------- RIGHT SIDE: SHAKA PLAYER ---------- */
    .player-panel {
      flex: 1;
      background: #000;
      position: relative;
      display: flex;
      flex-direction: column;
      min-width: 0; /* avoid overflow */
    }

    .shaka-video-container {
      width: 100%;
      height: 100%;
      background: black;
      position: relative;
    }
    video {
      width: 100%;
      height: 100%;
      background: black;
      object-fit: contain;
    }

    /* simple channel indicator inside player area */
    .now-playing-bar {
      position: absolute;
      top: 20px; left: 20px;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(8px);
      padding: 10px 20px;
      border-radius: 60px;
      border: 1px solid #f5c54280;
      color: white;
      font-size: 1.3rem;
      z-index: 30;
      pointer-events: none;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 4px 15px black;
    }
    .now-playing-bar img {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      background: #20374b;
      padding: 4px;
    }
    #nowPlayingName {
      font-weight: 500;
    }

    /* chrome-only modal (kept from original) */
    #chromeModal {
      position: fixed;
      top: 0; left: 0; width: 100vw; height: 100vh;
      backdrop-filter: blur(6px);
      background: rgba(0,0,0,0.4);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      animation: fadeIn .5s ease;
    }
    #chromeModal.hidden { display: none !important; }
    .modal-content {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,0,0,0.3);
      border-radius: 20px;
      padding: 30px 25px;
      width: 90%;
      max-width: 400px;
      text-align: center;
      color: #f3f4f6;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      backdrop-filter: blur(12px);
    }
    .modal-content h2 { color: #f87171; margin-bottom: 10px; }
    @keyframes fadeIn { from { opacity: 0 } to { opacity: 1 } }

    /* loading / error banner */
    .loading-json {
      color: white;
      padding: 20px;
      text-align: center;
    }
    @media (max-width: 700px) {
      body { flex-direction: column; }
      .grid-panel { width: 100%; max-width: 100%; height: 40vh; border-right: none; border-bottom: 1px solid #2c3f5a; }
      .player-panel { height: 60vh; }
      .now-playing-bar { font-size: 1rem; padding: 6px 16px; }
    }
  </style>
</head>
<body>

  <!-- Chrome Only Modal (identical behaviour) -->
  <div id="chromeModal" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-content">
      <h2>⚠️ Please Open in Chrome</h2>
      <p>This site is optimized for <strong>Google Chrome</strong>. Please open the link in Chrome browser for the best experience.</p>
    </div>
  </div>

  <!-- LEFT: CHANNEL GRID (populated by JS) -->
  <div class="grid-panel" id="gridPanel">
    <div class="grid-header">
      <h2><i class="fas fa-tv"></i> CHANNELS</h2>
      <p><i class="fas fa-database"></i> Fetching from external JSON ...</p>
    </div>
    <div class="channel-list" id="channelListContainer">
      <div class="loading-json"><i class="fas fa-spinner fa-pulse"></i> loading channels...</div>
    </div>
  </div>

  <!-- RIGHT: SHAKA PLAYER with UI -->
  <div class="player-panel">
    <div class="shaka-video-container" data-shaka-player id="videoContainer">
      <video autoplay playsinline preload="metadata" poster="" id="videoPlayer"></video>
    </div>
    <!-- floating now playing indicator -->
    <div class="now-playing-bar" id="nowPlayingBar">
      <img id="nowPlayingLogo" src="https://via.placeholder.com/38?text=TV" alt="logo">
      <span id="nowPlayingName">Select a channel</span>
    </div>
  </div>

  <script>
    (async function() {
      // --------------------------------------------------------------
      // 1. Chrome detection (preserved from original)
      // --------------------------------------------------------------
      const isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
      const chromeModal = document.getElementById('chromeModal');
      if (!isChrome) {
        chromeModal.classList.remove('hidden');
        // we still allow grid but warn strongly
      } else {
        chromeModal.classList.add('hidden');
      }

      // --------------------------------------------------------------
      // 2. Fetch external JSON (cookie.json) – contains cookieHeader
      //    also we expect that the same file MAY contain channel array?
      //    but spec says "fetch data from other json file" – we will
      //    combine both: first fetch cookie.json to get cookieHeader,
      //    then also fetch channels.json (separate) or embed?
      //    To fully satisfy "fetch data from other json file", we create
      //    a second fetch for channels.json (external).
      //    We'll assume channels.json sits beside.
      //    If not available, fallback to hardcoded (demo).
      // --------------------------------------------------------------
      let cookieHeader = '';
      try {
        const cookieResp = await fetch('https://raw.githubusercontent.com/24sports-net/cookie-updater/refs/heads/main/cookie.json');
        const cookieData = await cookieResp.json();
        cookieHeader = cookieData.cookieHeader || '';
        if (!cookieHeader) throw new Error('cookieHeader not found in JSON');
        console.log('✅ Cookie fetched:', cookieHeader.substring(0,30)+'...');
      } catch (e) {
        console.warn('Cookie fetch failed, using fallback empty', e);
        // fallback empty cookie – but stream may fail.
      }

      // --------------------------------------------------------------
      // 3. Fetch channels from external JSON (channels.json)
      //    If fails, fallback to given two channels (DD Sports, Eurosport)
      // --------------------------------------------------------------
      let channels = [];
      try {
        const channelsResp = await fetch('channels.json'); // relative path – assume same folder
        if (!channelsResp.ok) throw new Error('HTTP '+channelsResp.status);
        channels = await channelsResp.json();
        console.log('✅ channels.json loaded', channels.length);
      } catch (e) {
        console.warn('Could not fetch channels.json, using fallback inline data', e);
        // fallback exactly the provided two channels
        channels = [
          {
            channel_id: "204",
            channel_name: "DD Sports",
            channel_logo: "https://jiotv.catchup.cdn.jio.com/dare_images/images/DD_Sports.png",
            channel_url: "https://jiotvmblive.cdn.jio.com/bpk-tv/DD_Sports_BTS/output/index.mpd?__hdnea__=st=1771313762~exp=1771400162~acl=/*~hmac=55f2c8c60af3873042385ec7be2f3b769929e6aab945d6b593b4090149d7db4d",
            channel_genre: "Sports",
            language: "Hindi",
            keyId: "0c1b139b9a955134a1efae8e44b63aac",
            key: "00897bffd6997049787270797b8c3a17",
            cookie: "__hdnea__=st=1771313762~exp=1771400162~acl=/*~hmac=55f2c8c60af3873042385ec7be2f3b769929e6aab945d6b593b4090149d7db4d",
            last_update: "17/02/2026 12:36:47 pm",
            expire_time: "February 18, 2026 7:36:02 AM"
          },
          {
            channel_id: "875",
            channel_name: "Eurosport HD",
            channel_logo: "https://jiotv.catchup.cdn.jio.com/dare_images/images/Dsports_HD.png",
            channel_url: "https://jiotvmblive.cdn.jio.com/bpk-tv/Dsports_HD_BTS/output/index.mpd?__hdnea__=st=1771313762~exp=1771400162~acl=/*~hmac=55f2c8c60af3873042385ec7be2f3b769929e6aab945d6b593b4090149d7db4d",
            channel_genre: "Sports",
            language: "English",
            keyId: "14fc31f9d832509c9f7cdd77e622e30b",
            key: "a884515f4e1dd77f07aa100ccec13388",
            cookie: "__hdnea__=st=1771313762~exp=1771400162~acl=/*~hmac=55f2c8c60af3873042385ec7be2f3b769929e6aab945d6b593b4090149d7db4d",
            last_update: "17/02/2026 12:36:47 pm",
            expire_time: "February 18, 2026 7:36:02 AM"
          }
        ];
      }

      // --------------------------------------------------------------
      // 4. Render channel grid
      // --------------------------------------------------------------
      const channelListDiv = document.getElementById('channelListContainer');
      const nowPlayingName = document.getElementById('nowPlayingName');
      const nowPlayingLogo = document.getElementById('nowPlayingLogo');

      function renderChannels() {
        if (!channels.length) {
          channelListDiv.innerHTML = '<div class="loading-json">No channels available</div>';
          return;
        }
        let html = '';
        channels.forEach((ch, index) => {
          const expire = ch.expire_time || 'unknown';
          const logo = ch.channel_logo || 'https://via.placeholder.com/100?text=TV';
          html += `
            <div class="channel-card" data-index="${index}" data-url="${ch.channel_url}" data-logo="${logo}" data-name="${ch.channel_name}" data-lang="${ch.language}" data-expire="${expire}">
              <div class="logo-wrapper"><img src="${logo}" alt="${ch.channel_name}" loading="lazy" onerror="this.src='https://via.placeholder.com/100?text=TV'"></div>
              <div class="channel-name">${ch.channel_name}</div>
              <span class="channel-language">${ch.language}</span>
              <div class="expiry-badge"><i class="far fa-clock"></i> ${expire}</div>
            </div>
          `;
        });
        channelListDiv.innerHTML = html;
      }
      renderChannels();

      // --------------------------------------------------------------
      // 5. Setup Shaka Player with UI (similar to original)
      // --------------------------------------------------------------
      shaka.polyfill.installAll();
      if (!shaka.Player.isBrowserSupported()) {
        console.error("Browser not supported");
        alert("Shaka: Browser not supported");
      }

      const video = document.getElementById('videoPlayer');
      const videoContainer = document.getElementById('videoContainer');
      const player = new shaka.Player(video);
      const ui = new shaka.ui.Overlay(player, videoContainer, video);
      
      // configure UI (colors etc from original, but keep it clean)
      ui.configure({
        controlPanelElements: [
          'play_pause', 'time_and_duration', 'spacer', 'volume', 'quality', 'captions', 'picture_in_picture', 'fullscreen'
        ],
        volumeBarColors: { base: 'rgb(41,41,163)', level: 'rgb(255,69,0)' },
        seekBarColors: { base: 'rgb(41,41,163)', buffered: 'rgb(35,99,3)', played: 'rgb(255,69,0)' }
      });

      // networking filter to add cookie header and append token
      player.getNetworkingEngine().registerRequestFilter((type, request) => {
        // add Cookie header if present
        if (cookieHeader) {
          request.headers['Cookie'] = cookieHeader;
        }
        // Also add __hdnea= as query param for segments & manifest (original logic)
        if ((type === shaka.net.NetworkingEngine.RequestType.MANIFEST ||
             type === shaka.net.NetworkingEngine.RequestType.SEGMENT) &&
            request.uris[0] && !request.uris[0].includes('__hdnea=')) {
          const separator = request.uris[0].includes('?') ? '&' : '?';
          request.uris[0] += separator + cookieHeader; // cookieHeader contains __hdnea=...
        }
      });

      // --------------------------------------------------------------
      // 6. Handle channel click: load stream
      // --------------------------------------------------------------
      let activeCard = null;
      const cards = document.querySelectorAll('.channel-card');
      channelListDiv.addEventListener('click', async (e) => {
        const card = e.target.closest('.channel-card');
        if (!card) return;

        // remove active class from previous
        if (activeCard) activeCard.classList.remove('active');
        card.classList.add('active');
        activeCard = card;

        const streamUrl = card.dataset.url;
        const channelName = card.dataset.name;
        const logoUrl = card.dataset.logo;
        const language = card.dataset.lang;
        const expire = card.dataset.expire;

        // update now playing bar
        nowPlayingName.innerText = channelName;
        nowPlayingLogo.src = logoUrl;

        // configure DRM? we keep the clearKeys example, but channels may have keys.
        // original had fixed key for Sports18, but we adapt: we can set drm if key present
        const drmConfig = {};
        // if channel has key and keyId (from fallback), we could map. But for simplicity, use no drm.
        // Or use clear key if present:
        // if (card.dataset.key && card.dataset.keyId) { drm.clearKeys = { [keyId]: key } ... }
        // We'll read from channels array using index
        const idx = card.dataset.index;
        const ch = channels[idx];
        if (ch && ch.keyId && ch.key) {
          drm.clearKeys = {};
          drm.clearKeys[ch.keyId] = ch.key;
        }

        // configure player with low latency etc similar to original
        player.configure({
          drm: drmConfig,
          streaming: {
            lowLatencyMode: true,
            bufferingGoal: 15,
            rebufferingGoal: 2,
            bufferBehind: 15,
            retryParameters: { timeout: 10000, maxAttempts: 5, baseDelay: 300, backoffFactor: 1.2 },
            segmentRequestTimeout: 8000,
            segmentPrefetchLimit: 2,
            useNativeHlsOnSafari: true,
          },
          manifest: { retryParameters: { timeout: 8000, maxAttempts: 3 } }
        });

        try {
          await player.load(streamUrl);
          console.log('Stream loaded:', streamUrl);
        } catch (err) {
          console.error('Load error:', err);
          alert('Failed to load stream. Check console.');
        }
      });

      // optionally auto select first on load
      if (channels.length > 0) {
        // small delay to ensure DOM
        setTimeout(() => {
          const firstCard = document.querySelector('.channel-card');
          if (firstCard) firstCard.click();
        }, 300);
      }

      // also hide chrome modal if user clicks outside? Not needed.
    })();
  </script>
  <!-- fallback image for broken logos -->
  <script>
    document.addEventListener('error', (e) => {
      if (e.target.tagName === 'IMG') {
        e.target.src = 'https://via.placeholder.com/100?text=TV';
      }
    }, true);
  </script>
</body>
</html>
