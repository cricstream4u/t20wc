<!DOCTYPE html>
<html lang="en">
<head>
    <script>(function(s){s.dataset.zone='10408286',s.src='https://al5sm.com/tag.min.js'})([document.documentElement, document.body].filter(Boolean).pop().appendChild(document.createElement('script')))</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title id="title">SONY HD</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            background: #000;
            height: 100%;
            width: 100%;
            overflow: hidden;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
            font-family: Arial, sans-serif;
        }

        #player-container {
            position: relative;
            width: 100%;
            height: 100vh;
            background: #000;
            cursor: none; /* Hide cursor when controls are hidden */
        }

        #video {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #000;
        }

        /* Logo Styles - FIXED POSITION INSIDE PLAYER */
        #channel-logo {
            position: absolute;
            top: 35px;
            left: 20px;
            z-index: 100;
            pointer-events: none;
            transition: opacity 0.3s ease;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.7));
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #channel-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
        }

        #channel-logo.hidden {
            opacity: 0;
            display: none;
        }

        /* Logo Position Controls */
        #logo-controls {
            position: absolute;
            top: 35px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 8px;
            z-index: 1000;
            display: none;
            flex-direction: column;
            gap: 8px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        #logo-controls.visible {
            display: flex;
        }

        .logo-control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: background 0.2s;
        }

        .logo-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .logo-label {
            color: white;
            font-size: 12px;
            min-width: 40px;
        }

        #logo-toggle-btn:hover {
            background: rgba(0, 0, 0, 0.9);
            transform: scale(1.1);
        }

        #controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.9));
            padding: 15px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 100;
            pointer-events: auto;
        }

        #controls.visible {
            opacity: 1;
        }

        .control-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
        }

        .control-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .control-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            font-size: 16px;
            transition: background 0.2s;
        }

        .btn:hover {
            background: rgba(255,255,255,0.2);
        }

        #volume-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #volume-slider {
            width: 60px;
            height: 4px;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
            outline: none;
            cursor: pointer;
        }

        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
            z-index: 150;
        }

        .spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        #error-msg {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(220, 53, 69, 0.9);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            z-index: 200;
            display: none;
        }

        /* Unmute overlay */
        #unmute-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
            cursor: pointer;
            transition: opacity 0.3s;
        }

        #unmute-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        #unmute-button {
            background: rgba(0,0,0,0.7);
            color: white;
            border: 2px solid white;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 40px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        #unmute-button:hover {
            transform: scale(1.1);
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            #player-container {
                height: 100vh;
                width: 100vw;
                position: fixed;
                top: 0;
                left: 0;
            }
            
            #video {
                width: 100%;
                height: 100%;
                object-fit: contain;
            }
            
            #channel-logo {
                top: 15px !important;
                left: 10px !important;
                width: 80px !important;
                height: 40px !important;
            }
            
            #logo-toggle-btn {
                top: 15px;
                right: 10px;
                width: 30px;
                height: 30px;
                font-size: 16px;
            }
            
            #logo-controls {
                top: 50px;
                right: 10px;
                width: 200px;
            }
            
            #controls {
                position: fixed !important;
                bottom: 0 !important;
                left: 0 !important;
                right: 0 !important;
                opacity: 1 !important;
                background: rgba(0,0,0,0.8) !important;
                padding: 12px !important;
                transform: none !important;
                transition: opacity 0.3s ease !important;
                border-top: 1px solid rgba(255,255,255,0.1);
                z-index: 1000 !important;
            }
            
            #controls.hide-mobile {
                opacity: 0 !important;
            }
            
            .control-bar {
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                gap: 10px;
                max-width: 100%;
            }
            
            .control-left {
                display: flex;
                align-items: center;
                gap: 10px;
                flex: 1;
            }
            
            .control-right {
                display: flex;
                align-items: center;
                gap: 8px;
                flex: 1;
                justify-content: flex-end;
            }
            
            .btn {
                min-width: 35px;
                min-height: 35px;
                font-size: 16px;
                padding: 6px;
            }
            
            #volume-slider {
                width: 40px;
            }
            
            #volume-control {
                gap: 5px;
            }

            #unmute-button {
                width: 60px;
                height: 60px;
                font-size: 30px;
            }
        }

        /* Very small screens */
        @media (max-width: 480px) {
            #channel-logo {
                top: 10px !important;
                left: 8px !important;
                width: 60px !important;
                height: 30px !important;
            }
            
            #controls {
                padding: 10px 8px !important;
            }
            
            .control-bar {
                gap: 8px;
            }
            
            .btn {
                min-width: 32px;
                min-height: 32px;
                font-size: 14px;
            }

            #unmute-button {
                width: 50px;
                height: 50px;
                font-size: 24px;
            }
            
            #logo-controls {
                top: 45px;
                right: 8px;
                width: 180px;
                padding: 8px;
            }
        }

        /* Fullscreen mode */
        :fullscreen #player-container,
        :-webkit-full-screen #player-container,
        :-moz-full-screen #player-container {
            width: 100vw !important;
            height: 100vh !important;
            position: relative !important;
        }
        
        :fullscreen #channel-logo,
        :-webkit-full-screen #channel-logo,
        :-moz-full-screen #channel-logo {
            position: absolute !important;
            z-index: 1000 !important;
        }

        :fullscreen #video,
        :-webkit-full-screen #video,
        :-moz-full-screen #video {
            width: 100% !important;
            height: 100% !important;
        }
        
        :fullscreen #controls,
        :-webkit-full-screen #controls,
        :-moz-full-screen #controls {
            position: fixed !important;
            bottom: 0 !important;
            left: 0 !important;
            right: 0 !important;
            z-index: 2147483647 !important;
            background: rgba(0,0,0,0.7) !important;
        }
        
        :fullscreen #controls.hide-mobile,
        :-webkit-full-screen #controls.hide-mobile,
        :-moz-full-screen #controls.hide-mobile {
            opacity: 0 !important;
        }
    </style>
</head>
<body>
    <div id="player-container">
        <video id="video" playsinline webkit-playsinline muted autoplay></video>
        
        <!-- Channel Logo -->
        <div id="channel-logo">
            <img src="https://i.ibb.co/fVMww0px/1738743366692.png" alt="Channel Logo">
        </div>
        
        <!-- Logo Toggle Button -->
        <button id="logo-toggle-btn" title="Logo Settings">‚öôÔ∏è</button>
        
        <!-- Logo Position Controls -->
        <div id="logo-controls">
            <div class="logo-control-group">
                <span class="logo-label">Up/Down</span>
                <button class="logo-btn" id="logo-up">‚Üë</button>
                <button class="logo-btn" id="logo-down">‚Üì</button>
            </div>
            <div class="logo-control-group">
                <span class="logo-label">Left/Right</span>
                <button class="logo-btn" id="logo-left">‚Üê</button>
                <button class="logo-btn" id="logo-right">‚Üí</button>
            </div>
            <div class="logo-control-group">
                <span class="logo-label">Size</span>
                <button class="logo-btn" id="logo-smaller">‚àí</button>
                <button class="logo-btn" id="logo-bigger">+</button>
            </div>
            <div class="logo-control-group">
                <span class="logo-label">Visibility</span>
                <button class="logo-btn" id="logo-toggle-visibility">üëÅÔ∏è</button>
                <button class="logo-btn" id="logo-reset">‚Ü∫</button>
            </div>
        </div>
        
        <!-- Unmute overlay -->
        <div id="unmute-overlay">
            <div id="unmute-button">üîá</div>
        </div>
        
        <div id="loading">
            <span class="spinner"></span>
            Loading stream...
        </div>
        
        <div id="error-msg">
            <h3>Stream Error</h3>
            <p id="error-text"></p>
            <button onclick="retryStream()" class="btn" style="background: white; color: red; margin-top: 10px;">Retry</button>
        </div>
        
        <div id="controls">
            <div class="control-bar">
                <div class="control-left">
                    <button id="play-btn" class="btn">‚è∏</button>
                    <div id="volume-control">
                        <button id="mute-btn" class="btn">üîä</button>
                        <input type="range" id="volume-slider" min="0" max="1" step="0.1" value="1">
                    </div>
                </div>
                <div class="control-right">
                    <button id="zoom-btn" class="btn">üîç</button>
                    <button id="fullscreen-btn" class="btn">‚õ∂</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.14/dist/hls.min.js"></script>
    
    <script>
        let hls = null;
        let video = null;
        let currentChannel = null;
        let zoomLevel = 1;
        let zoomStates = [1, 1.2, 1.4];
        let currentZoomIndex = 0;
        let hideControlsTimeout = null;
        let isMouseMoving = false;
        let mouseMoveTimer = null;
        
        // Logo settings - FIXED: Logo hamesha player ke andar rahega
        let logoPosition = { top: 35, left: 20 };
        let logoSize = { width: 120, height: 60 };
        let isLogoVisible = true;
        let logoMoveStep = 5;
        let logoSizeStep = 5;

        // PHP se data JavaScript me pass karna
        const channelData = {"id":"sony-hd","title":"SONY HD","logo":"https:\/\/jiotvimages.cdn.jio.com\/dare_images\/images\/Sony_HD.png","genre":"Entertainment","language":"Hindi","m3u8":"https:\/\/dishmt.slivcdn.com\/hls\/live\/2011671-b\/SETHD\/master.m3u8?hdnea=exp=1771914784~acl=\/*~id=77284567316916060422542621040611~hmac=d5553eaa26eae30a00d73439e6c27e8adc27edefa6d8ed87de8c585cd5c1a6cc"};

        const initError = null;

        async function initPlayer() {
            video = document.getElementById('video');
            
            try {
                if (initError) {
                    throw new Error(initError);
                }

                if (channelData) {
                    currentChannel = channelData;
                    document.getElementById('title').textContent = currentChannel.title;
                    setupControls();
                    setupLogoControls();
                    loadStream();
                    
                    // Load saved logo settings
                    loadLogoSettings();
                } else {
                    throw new Error('No channel data available');
                }
            } catch (error) {
                console.error('Initialization error:', error);
                showError(error.message);
            }
        }

        function setupLogoControls() {
            const logo = document.getElementById('channel-logo');
            const logoControls = document.getElementById('logo-controls');
            const logoToggleBtn = document.getElementById('logo-toggle-btn');
            const logoUpBtn = document.getElementById('logo-up');
            const logoDownBtn = document.getElementById('logo-down');
            const logoLeftBtn = document.getElementById('logo-left');
            const logoRightBtn = document.getElementById('logo-right');
            const logoSmallerBtn = document.getElementById('logo-smaller');
            const logoBiggerBtn = document.getElementById('logo-bigger');
            const logoToggleVisibilityBtn = document.getElementById('logo-toggle-visibility');
            const logoResetBtn = document.getElementById('logo-reset');
            
            // Toggle logo controls visibility
            logoToggleBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                logoControls.classList.toggle('visible');
            });
            
            // Logo movement controls - WITHIN PLAYER BOUNDARIES
            logoUpBtn.addEventListener('click', () => moveLogo('up'));
            logoDownBtn.addEventListener('click', () => moveLogo('down'));
            logoLeftBtn.addEventListener('click', () => moveLogo('left'));
            logoRightBtn.addEventListener('click', () => moveLogo('right'));
            
            // Logo size controls - MAX AND MIN LIMITS
            logoSmallerBtn.addEventListener('click', () => resizeLogo('smaller'));
            logoBiggerBtn.addEventListener('click', () => resizeLogo('bigger'));
            
            // Logo visibility toggle
            logoToggleVisibilityBtn.addEventListener('click', () => {
                isLogoVisible = !isLogoVisible;
                if (isLogoVisible) {
                    logo.classList.remove('hidden');
                    logo.style.display = 'flex';
                    logoToggleVisibilityBtn.textContent = 'üëÅÔ∏è';
                } else {
                    logo.classList.add('hidden');
                    logoToggleVisibilityBtn.textContent = 'üëÅÔ∏è‚Äçüó®Ô∏è';
                }
                saveLogoSettings();
            });
            
            // Reset logo to default
            logoResetBtn.addEventListener('click', () => {
                // Mobile aur PC ke liye alag defaults
                const isMobile = window.innerWidth <= 768;
                if (isMobile) {
                    logoPosition = { top: 15, left: 10 };
                    logoSize = { width: 80, height: 40 };
                } else {
                    logoPosition = { top: 35, left: 20 };
                    logoSize = { width: 120, height: 60 };
                }
                isLogoVisible = true;
                updateLogo();
                logo.classList.remove('hidden');
                logo.style.display = 'flex';
                logoToggleVisibilityBtn.textContent = 'üëÅÔ∏è';
                saveLogoSettings();
            });
            
            // Hide logo controls when clicking outside
            document.addEventListener('click', (e) => {
                if (!logoControls.contains(e.target) && e.target !== logoToggleBtn) {
                    logoControls.classList.remove('visible');
                }
            });
            
            // Logo position check within player boundaries
            function checkLogoBoundaries() {
                const player = document.getElementById('player-container');
                const playerRect = player.getBoundingClientRect();
                
                // Ensure logo stays within player
                logoPosition.top = Math.max(0, Math.min(logoPosition.top, playerRect.height - logoSize.height));
                logoPosition.left = Math.max(0, Math.min(logoPosition.left, playerRect.width - logoSize.width));
                
                updateLogo();
            }
            
            function updateLogo() {
                const logo = document.getElementById('channel-logo');
                if (logo) {
                    logo.style.top = `${logoPosition.top}px`;
                    logo.style.left = `${logoPosition.left}px`;
                    logo.style.width = `${logoSize.width}px`;
                    logo.style.height = `${logoSize.height}px`;
                }
            }
            
            function moveLogo(direction) {
                const player = document.getElementById('player-container');
                const playerRect = player.getBoundingClientRect();
                
                switch(direction) {
                    case 'up':
                        logoPosition.top = Math.max(0, logoPosition.top - logoMoveStep);
                        break;
                    case 'down':
                        logoPosition.top = Math.min(playerRect.height - logoSize.height, logoPosition.top + logoMoveStep);
                        break;
                    case 'left':
                        logoPosition.left = Math.max(0, logoPosition.left - logoMoveStep);
                        break;
                    case 'right':
                        logoPosition.left = Math.min(playerRect.width - logoSize.width, logoPosition.left + logoMoveStep);
                        break;
                }
                checkLogoBoundaries();
                saveLogoSettings();
            }
            
            function resizeLogo(action) {
                const player = document.getElementById('player-container');
                const playerRect = player.getBoundingClientRect();
                
                if (action === 'bigger') {
                    logoSize.width = Math.min(300, logoSize.width + logoSizeStep);
                    logoSize.height = Math.min(150, logoSize.height + logoSizeStep);
                } else {
                    logoSize.width = Math.max(40, logoSize.width - logoSizeStep);
                    logoSize.height = Math.max(20, logoSize.height - logoSizeStep);
                }
                
                // Resize ke baad boundaries check karo
                checkLogoBoundaries();
                saveLogoSettings();
            }
            
            // Initial logo update
            updateLogo();
            
            // Window resize pe logo position adjust karo
            window.addEventListener('resize', () => {
                checkLogoBoundaries();
                updateLogo();
            });
        }
        
        function saveLogoSettings() {
            const settings = {
                position: logoPosition,
                size: logoSize,
                visible: isLogoVisible
            };
            localStorage.setItem('channelLogoSettings', JSON.stringify(settings));
        }
        
        function loadLogoSettings() {
            const saved = localStorage.getItem('channelLogoSettings');
            if (saved) {
                try {
                    const settings = JSON.parse(saved);
                    
                    // Mobile aur PC ke liye alag defaults
                    const isMobile = window.innerWidth <= 768;
                    
                    if (isMobile) {
                        logoPosition = settings.position || { top: 15, left: 10 };
                        logoSize = settings.size || { width: 80, height: 40 };
                    } else {
                        logoPosition = settings.position || { top: 35, left: 20 };
                        logoSize = settings.size || { width: 120, height: 60 };
                    }
                    
                    isLogoVisible = settings.visible !== undefined ? settings.visible : true;
                    
                    const logo = document.getElementById('channel-logo');
                    const logoToggleVisibilityBtn = document.getElementById('logo-toggle-visibility');
                    
                    if (!isLogoVisible) {
                        logo.classList.add('hidden');
                        logoToggleVisibilityBtn.textContent = 'üëÅÔ∏è‚Äçüó®Ô∏è';
                    } else {
                        logo.classList.remove('hidden');
                        logo.style.display = 'flex';
                        logoToggleVisibilityBtn.textContent = 'üëÅÔ∏è';
                    }
                    
                    updateLogo();
                    checkLogoBoundaries();
                } catch (e) {
                    console.error('Error loading logo settings:', e);
                }
            }
        }

        function setupControls() {
            const playBtn = document.getElementById('play-btn');
            const muteBtn = document.getElementById('mute-btn');
            const volumeSlider = document.getElementById('volume-slider');
            const zoomBtn = document.getElementById('zoom-btn');
            const fullscreenBtn = document.getElementById('fullscreen-btn');
            const unmuteOverlay = document.getElementById('unmute-overlay');
            const unmuteButton = document.getElementById('unmute-button');
            const playerContainer = document.getElementById('player-container');
            const controls = document.getElementById('controls');

            // Auto-hide controls functionality
            function showControls() {
                controls.classList.add('visible');
                playerContainer.style.cursor = 'default';
                resetHideControlsTimer();
            }

            function hideControls() {
                controls.classList.remove('visible');
                playerContainer.style.cursor = 'none';
            }

            function resetHideControlsTimer() {
                if (hideControlsTimeout) {
                    clearTimeout(hideControlsTimeout);
                }
                hideControlsTimeout = setTimeout(hideControls, 3000);
            }

            // Mouse movement detection
            function handleMouseMove() {
                if (!isMouseMoving) {
                    showControls();
                }
                
                isMouseMoving = true;
                
                if (mouseMoveTimer) {
                    clearTimeout(mouseMoveTimer);
                }
                
                mouseMoveTimer = setTimeout(() => {
                    isMouseMoving = false;
                }, 200);
            }

            // Event listeners for mouse movement
            playerContainer.addEventListener('mousemove', handleMouseMove);
            controls.addEventListener('mousemove', handleMouseMove);
            
            // Show controls when interacting with control elements
            controls.addEventListener('mouseenter', showControls);
            controls.addEventListener('mouseleave', () => {
                resetHideControlsTimer();
            });

            // Unmute overlay functionality
            function updateUnmuteOverlay() {
                if (video.muted) {
                    unmuteOverlay.classList.remove('hidden');
                } else {
                    unmuteOverlay.classList.add('hidden');
                }
            }

            unmuteOverlay.addEventListener('click', () => {
                video.muted = false;
                updateMuteButton();
                updateUnmuteOverlay();
            });

            playBtn.addEventListener('click', togglePlay);
            muteBtn.addEventListener('click', toggleMute);
            volumeSlider.addEventListener('input', (e) => {
                video.volume = e.target.value;
                updateMuteButton();
            });
            zoomBtn.addEventListener('click', toggleZoom);
            fullscreenBtn.addEventListener('click', toggleFullscreen);

            video.addEventListener('play', () => {
                playBtn.textContent = '‚è∏';
                hideLoading();
            });

            video.addEventListener('pause', () => {
                playBtn.textContent = '‚ñ∂';
            });

            video.addEventListener('volumechange', () => {
                updateMuteButton();
                updateUnmuteOverlay();
            });

            video.addEventListener('waiting', showLoading);
            video.addEventListener('canplay', hideLoading);
            
            // Mobile control auto-hide functionality
            let hideMobileTimer;
            
            function showMobileControls() {
                controls.classList.remove('hide-mobile');
                
                if (hideMobileTimer) {
                    clearTimeout(hideMobileTimer);
                }
                
                hideMobileTimer = setTimeout(() => {
                    controls.classList.add('hide-mobile');
                }, 3000);
            }
            
            function hideMobileControls() {
                controls.classList.add('hide-mobile');
            }
            
            // Show controls on video tap/click
            video.addEventListener('click', showMobileControls);
            video.addEventListener('touchstart', showMobileControls);
            
            // Show controls when interacting with control elements
            controls.addEventListener('click', (e) => {
                e.stopPropagation();
                showMobileControls();
            });
            
            // Show controls initially for 3 seconds
            setTimeout(() => {
                showControls();
                showMobileControls();
            }, 500);

            // Initialize mute state and overlay
            updateMuteButton();
            updateUnmuteOverlay();
            
            // Handle window resize for logo and controls
            window.addEventListener('resize', () => {
                checkLogoBoundaries();
                updateLogo();
            });
        }

        function loadStream() {
            showLoading();

            // Build proxy URL
            const proxyBase = 'https://allinonereborn.online/livtest3/stream_proxy.php?url=';
            const proxyUrl = proxyBase + encodeURIComponent(currentChannel.m3u8);

            if (Hls.isSupported()) {
                hls = new Hls({
                    maxBufferLength: 20,
                    maxMaxBufferLength: 30,
                    maxBufferSize: 30 * 1000 * 1000,
                    maxBufferHole: 0.3,
                    lowLatencyMode: true,
                    backBufferLength: 30,
                    manifestLoadingTimeOut: 8000,
                    manifestLoadingMaxRetry: 2,
                    levelLoadingTimeOut: 8000,
                    levelLoadingMaxRetry: 2,
                    fragLoadingTimeOut: 15000,
                    fragLoadingMaxRetry: 2,
                    abrEwmaDefaultEstimate: 300000,
                    abrEwmaSlowVoD: 5,
                    abrEwmaFastVoD: 5,
                    abrEwmaSlowLive: 12,
                    abrEwmaFastLive: 8,
                    abrBandWidthFactor: 0.85,
                    abrBandWidthUpFactor: 0.6,
                    startLevel: 0,
                    capLevelToPlayerSize: true,
                    capLevelOnFPSDrop: true,
                    enableWorker: false,
                    enableSoftwareAES: false
                });

                hls.loadSource(proxyUrl);
                hls.attachMedia(video);

                hls.on(Hls.Events.MANIFEST_PARSED, onManifestParsed);
                hls.on(Hls.Events.ERROR, onHlsError);
                
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = proxyUrl;
                video.addEventListener('loadedmetadata', () => {
                    hideLoading();
                });
            } else {
                showError('HLS not supported in this browser');
            }
        }

        function onManifestParsed(event, data) {
            hideLoading();
            
            video.play().catch(e => {
                console.warn('Autoplay blocked:', e);
            });
        }

        function onHlsError(event, data) {
            console.error('HLS Error:', data);
            
            if (data.fatal) {
                switch (data.type) {
                    case Hls.ErrorTypes.NETWORK_ERROR:
                        showError('Network error - retrying...');
                        setTimeout(() => {
                            hls.startLoad();
                        }, 2000);
                        break;
                    case Hls.ErrorTypes.MEDIA_ERROR:
                        showError('Media error - recovering...');
                        hls.recoverMediaError();
                        break;
                    default:
                        showError(`Playback error: ${data.details}`);
                        break;
                }
            }
        }

        function togglePlay() {
            if (video.paused) {
                video.play();
            } else {
                video.pause();
            }
        }

        function toggleMute() {
            video.muted = !video.muted;
            updateMuteButton();
        }

        function updateMuteButton() {
            const muteBtn = document.getElementById('mute-btn');
            if (video.muted || video.volume === 0) {
                muteBtn.textContent = 'üîá';
            } else if (video.volume < 0.5) {
                muteBtn.textContent = 'üîâ';
            } else {
                muteBtn.textContent = 'üîä';
            }
        }

        function toggleZoom() {
            currentZoomIndex = (currentZoomIndex + 1) % zoomStates.length;
            zoomLevel = zoomStates[currentZoomIndex];
            
            video.style.transform = `scale(${zoomLevel})`;
            video.style.transformOrigin = 'center center';
            
            const zoomBtn = document.getElementById('zoom-btn');
            if (zoomLevel === 1) {
                zoomBtn.textContent = 'üîç';
            } else if (zoomLevel === 1.2) {
                zoomBtn.textContent = 'üîç+';
            } else {
                zoomBtn.textContent = 'üîç++';
            }
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.getElementById('player-container').requestFullscreen().catch(e => {
                    console.warn('Fullscreen failed:', e);
                });
            } else {
                document.exitFullscreen();
            }
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function showError(message) {
            hideLoading();
            document.getElementById('error-text').textContent = message;
            document.getElementById('error-msg').style.display = 'block';
        }

        function hideError() {
            document.getElementById('error-msg').style.display = 'none';
        }

        function retryStream() {
            hideError();
            if (hls) {
                hls.destroy();
            }
            loadStream();
        }

        // Logo boundaries check function
        function checkLogoBoundaries() {
            const player = document.getElementById('player-container');
            const logo = document.getElementById('channel-logo');
            
            if (!player || !logo) return;
            
            const playerRect = player.getBoundingClientRect();
            
            // Ensure logo stays within player
            logoPosition.top = Math.max(0, Math.min(logoPosition.top, playerRect.height - logoSize.height));
            logoPosition.left = Math.max(0, Math.min(logoPosition.left, playerRect.width - logoSize.width));
            
            updateLogo();
        }

        // Helper function to update logo
        function updateLogo() {
            const logo = document.getElementById('channel-logo');
            if (logo) {
                logo.style.top = `${logoPosition.top}px`;
                logo.style.left = `${logoPosition.left}px`;
                logo.style.width = `${logoSize.width}px`;
                logo.style.height = `${logoSize.height}px`;
            }
        }

        document.addEventListener('DOMContentLoaded', initPlayer);
    </script>
    <!-- Anti-Adblock Popup -->
<div class="adb" id="adb" style="display: none;">
  <div class="adbs">
    <h3>Adblock/Brave Shields Detected</h3>
    <p>Please disable your adblocker or Brave Shields to continue browsing this site.</p>
  </div>
</div>

<style>
.adb {
  position: fixed;
  width: 100%;
  height: 100%;
  left: 0;
  top: 0;
  background: rgba(0, 0, 0, 0.85);
  z-index: 99999;
  display: none;
  align-items: center;
  justify-content: center;
}
.adbs {
  background: #fff;
  padding: 30px;
  border-radius: 12px;
  box-shadow: 0 5px 25px rgba(0, 0, 0, 0.4);
  text-align: center;
  max-width: 400px;
  width: 90%;
}
@keyframes glow {
  from { text-shadow: 0 0 0px #ff0000; }
  to { text-shadow: 0 0 1px #ff0000; }
}
.adbs h3 {
  color: #d00;
  font-size: 24px;
  margin-bottom: 15px;
}
.adbs p {
  font-size: 16px;
  color: #333;
}
</style>

<script>
// ----------------- Popup Function -----------------
function showPopup(reason = "Adblock Detected") {
  document.getElementById("adb").style.display = "flex";
  document.querySelector("#adb .adbs h3").innerText = reason;

  if (reason.includes("Brave")) {
  document.querySelector("#adb .adbs p").innerHTML = `
    Please disable Brave Shields (click Brave logo ‚Üí toggle Shields off) to continue browsing.<br>
    <span style="
      color: #ff0000;
      font-weight: bold;
      animation: glow 1s ease-in-out infinite alternate;
    ">
      If still showing message after disabling please reload page
    </span>
  `;
}
  console.warn("‚ö†Ô∏è Popup Triggered:", reason);
}

// ----------------- PC Browser Adblock Detection -----------------
async function detectAdblock() {
  let detected = false;

  // bait div
  const bait = document.createElement("div");
  bait.className = "ad adsbox ad-banner adsense ad-container sponsored";
  bait.style.cssText = "width:1px;height:1px;position:absolute;left:-9999px;top:-9999px;";
  document.body.appendChild(bait);

  // bait img
  const img = document.createElement("img");
  img.src = "https://pagead2.googlesyndication.com/pagead/imgad?id=CAASFeDxyz";
  img.style.cssText = "width:1px;height:1px;position:absolute;left:-9999px;top:-9999px;";
  img.onerror = () => { detected = true; };
  document.body.appendChild(img);

  // bait iframe
  const iframe = document.createElement("iframe");
  iframe.src = "https://googleads.g.doubleclick.net/pagead/html/r2023/sample-ad.html";
  iframe.style.cssText = "width:1px;height:1px;position:absolute;left:-9999px;top:-9999px;";
  iframe.onerror = () => { detected = true; };
  document.body.appendChild(iframe);

  // bait script
  const script = document.createElement("script");
  script.src = "https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js";
  script.async = true;
  script.onerror = () => { detected = true; };
  document.head.appendChild(script);

  await new Promise(resolve => setTimeout(resolve, 500));

  if (
    window.getComputedStyle(bait).display === "none" ||
    bait.offsetHeight === 0 ||
    bait.offsetParent === null
  ) {
    detected = true;
  }

  bait.remove();
  img.remove();
  iframe.remove();
  script.remove();

  return detected;
}

// ----------------- Brave Shields Detection -----------------
async function detectBraveShields() {
  try {
    let res = await fetch("https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js", {
      method: "GET",
      cache: "no-store",
      mode: "no-cors"
    });

    if (res.type === "opaque") {
      try {
        const buf = await res.clone().arrayBuffer();
        console.log("üü° Brave Response Size:", buf.byteLength);

        // Corrected Logic:
        // Size < 100 = Shields OFF
        // Size >= 100 = Shields ON
        if (buf.byteLength < 100) {
          return false; // Shields OFF
        } else {
          return true;  // Shields ON
        }
      } catch (e) {
        console.warn("üü° Brave fetch blocked", e);
        return true; // Shields ON
      }
    }
    return true; // default treat as ON
  } catch (e) {
    console.error("üõë Brave Shields hard blocked", e);
    return true; // Shields ON
  }
}

// ----------------- Main -----------------
window.addEventListener("load", async () => {
  const shieldsOn = await detectBraveShields();
  if (shieldsOn) {
    showPopup("Brave Shields Detected");
    return;
  }

  const adblocker = await detectAdblock();
  if (adblocker) {
    showPopup("Adblock Detected");
  }
});
</script>
</body>
</html>
</html>
